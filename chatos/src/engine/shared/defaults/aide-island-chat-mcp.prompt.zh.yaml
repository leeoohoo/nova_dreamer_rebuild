name: mcp_aide_island_chat
title: MCP / 灵动岛聊天（AIDE Island Chat）
type: system
allowMain: false
allowSub: false
prompt: |
  <mcp_server name="aide_island_chat">
    <description>
      Island Chat MCP：外部调用专用。通过 AIDE 的“灵动岛/终端 run”通道向指定 run 发送消息，并把 AIDE 的事件流（主流程 + 子流程）实时回传给调用方（MCP notifications）。
    </description>

    <tool_prefix>
      工具前缀：`mcp_aide_island_chat_*`
    </tool_prefix>

    <workflow>
      1) 先调用 `mcp_aide_island_chat_list_sessions` 获取 run_id（会话列表）。
      2) 调用 `mcp_aide_island_chat_island_chat` 向某个 run_id 发送消息；如果不传 run_id：
         - 只有 1 个活跃会话时会自动选择
         - 否则会新建会话或要求你指定 run_id
      3) 需要查看某个会话的最近总结，用 `mcp_aide_island_chat_get_session_summary`。
    </workflow>

    <tool name="mcp_aide_island_chat_list_sessions">
      <when_to_use>
        ✅ 需要选择/枚举当前已有会话（run_id）
        ✅ 需要判断某个会话是否 alive / 是否 busy
      </when_to_use>
    </tool>

    <tool name="mcp_aide_island_chat_island_chat">
      <when_to_use>
        ✅ 向灵动岛（某个 run_id）发起聊天/纠正/追问
        ✅ 需要把 AIDE 的全过程（含 subagent）实时流式返回给调用方
      </when_to_use>

      <runtime_toggles>
        可选参数（与灵动岛开关一致；不传则使用当前默认值）：
        - `confirm_main_task_create`: 主流程任务创建确认
        - `confirm_sub_task_create`: 子流程任务创建确认
        - `confirm_file_changes`: 文件变更确认
        - `ui_terminal_mode`: `auto` | `system` | `headless`（拉起终端）
        - `persist_settings`: 默认 true；设为 false 表示仅本次请求临时覆盖，结束后恢复
      </runtime_toggles>

      <streaming>
        调用期间，服务端会通过 MCP `notifications/message` 流式发送 events.jsonl 里的事件（assistant_thinking / tool_call / subagent_* 等）。
        客户端应订阅并实时渲染这些通知。
      </streaming>
    </tool>

    <tool name="mcp_aide_island_chat_get_session_summary">
      <when_to_use>
        ✅ 获取某个 run 的最新总结（type=summary）
      </when_to_use>
    </tool>
  </mcp_server>
